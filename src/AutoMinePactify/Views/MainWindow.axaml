<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AutoMinePactify.ViewModels"
        xmlns:views="using:AutoMinePactify.Views"
        x:Class="AutoMinePactify.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="AutoMine Obsidienne - Pactify"
        Icon="/Assets/logo.png"
        Width="920" Height="640"
        CanResize="False"
        Background="#1A1B2E"
        WindowStartupLocation="CenterScreen">

    <Window.Styles>
        <Style Selector="Button.accent">
            <Setter Property="Background" Value="#A855F7"/>
            <Setter Property="Foreground" Value="#FFFFFF"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="20,10"/>
        </Style>
        <Style Selector="Button.accent:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#9333EA"/>
        </Style>

        <Style Selector="Button.danger">
            <Setter Property="Background" Value="#EF4444"/>
            <Setter Property="Foreground" Value="#FFFFFF"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="20,10"/>
        </Style>
        <Style Selector="Button.danger:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#DC2626"/>
        </Style>

        <Style Selector="Button.secondary">
            <Setter Property="Background" Value="#2D2F45"/>
            <Setter Property="Foreground" Value="#C0C4D6"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="16,10"/>
        </Style>
        <Style Selector="Button.secondary:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#3D3F55"/>
        </Style>

        <Style Selector="Button.stop">
            <Setter Property="Background" Value="#6B21A8"/>
            <Setter Property="Foreground" Value="#E0D0F0"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="20,10"/>
        </Style>
        <Style Selector="Button.stop:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#581C87"/>
        </Style>

        <Style Selector="Border.card">
            <Setter Property="Background" Value="#222438"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="16"/>
        </Style>

        <Style Selector="ListBox.logList">
            <Setter Property="Background" Value="#181926"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="4"/>
        </Style>
        <Style Selector="ListBox.logList ListBoxItem">
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="FontSize" Value="11.5"/>
            <Setter Property="Foreground" Value="#8B8FA3"/>
            <Setter Property="FontFamily" Value="Consolas, Courier New, monospace"/>
        </Style>

        <!-- Scrollbars fines et violettes partout -->
        <Style Selector="ScrollBar">
            <Setter Property="Width" Value="8"/>
        </Style>
        <Style Selector="ScrollBar /template/ Thumb">
            <Setter Property="Background" Value="#3D2F55"/>
            <Setter Property="MinHeight" Value="30"/>
        </Style>
        <Style Selector="ScrollBar /template/ Thumb:pointerover">
            <Setter Property="Background" Value="#A855F7"/>
        </Style>
        <Style Selector="ScrollBar /template/ Thumb:pressed">
            <Setter Property="Background" Value="#C084FC"/>
        </Style>
        <Style Selector="ScrollBar /template/ RepeatButton">
            <Setter Property="IsVisible" Value="False"/>
        </Style>
    </Window.Styles>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ═══ EN-TETE ══════════════════════════════════════════ -->
        <Grid Grid.Row="0" Margin="0,0,0,14">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                <Image Source="/Assets/logo.png"
                       Width="48" Height="32"
                       VerticalAlignment="Center"/>
                <StackPanel Spacing="2">
                    <TextBlock Text="AutoMine Obsidienne"
                               FontSize="20" FontWeight="Bold"
                               Foreground="#E8EAF0"/>
                    <TextBlock Text="Mine l'obsidienne tout seul sur Pactify"
                               FontSize="11" Foreground="#6B7080"/>
                </StackPanel>
            </StackPanel>

            <!-- Trouver Minecraft -->
            <Border Grid.Column="1"
                    Background="#222438" CornerRadius="8"
                    Padding="14,8">
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <Button Content="Trouver Minecraft"
                            Command="{Binding DetectMinecraftCommand}"
                            Classes="secondary"
                            Padding="12,6"
                            FontSize="11"/>

                    <!-- Rond violet = trouve -->
                    <Ellipse Width="10" Height="10"
                             Fill="#A855F7"
                             VerticalAlignment="Center"
                             IsVisible="{Binding IsMcDetected}"/>
                    <!-- Rond rouge = pas trouve -->
                    <Ellipse Width="10" Height="10"
                             Fill="#EF4444"
                             VerticalAlignment="Center"
                             IsVisible="{Binding !IsMcDetected}"/>

                    <TextBlock Text="{Binding McStatusText}"
                               FontSize="11.5"
                               Foreground="#9CA0B4"
                               VerticalAlignment="Center"
                               MaxWidth="200"
                               TextTrimming="CharacterEllipsis"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- ═══ CONTENU PRINCIPAL ════════════════════════════════ -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="14"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- ── GAUCHE : Reglages ─────────────────────────── -->
            <Border Grid.Column="0" Classes="card">
                <views:SettingsView DataContext="{Binding Settings}"/>
            </Border>

            <!-- ── DROITE : Etat + Comment faire + Messages ──── -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Etat actuel -->
                <Border Grid.Row="0" Classes="card">
                    <StackPanel Spacing="10">
                        <Grid ColumnDefinitions="*,Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="ETAT"
                                           FontWeight="Bold" FontSize="13"
                                           Foreground="#8B8FA3"/>
                                <TextBlock Text="{Binding StatusText}"
                                           FontSize="18" FontWeight="SemiBold"
                                           Foreground="#E8EAF0"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1"
                                        Orientation="Horizontal" Spacing="6"
                                        VerticalAlignment="Center">
                                <TextBlock Text="{Binding Progress}"
                                           FontSize="14" Foreground="#C4B5FD"/>
                                <TextBlock Text="/"
                                           FontSize="14" Foreground="#6B7080"/>
                                <TextBlock Text="{Binding MaxProgress}"
                                           FontSize="14" Foreground="#9CA0B4"/>
                                <TextBlock Text="blocs"
                                           FontSize="12" Foreground="#6B7080"
                                           VerticalAlignment="Center" Margin="2,0,0,0"/>
                            </StackPanel>
                        </Grid>

                        <ProgressBar Minimum="0"
                                     Maximum="{Binding MaxProgress}"
                                     Value="{Binding Progress}"
                                     Height="8"
                                     CornerRadius="4"
                                     Foreground="#A855F7"
                                     Background="#2D2F45"/>
                    </StackPanel>
                </Border>

                <!-- Comment se placer -->
                <Border Grid.Row="2"
                        Background="#1E1533" CornerRadius="10"
                        Padding="14,12"
                        BorderBrush="#3B2667" BorderThickness="1">
                    <StackPanel Spacing="6">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="?" FontSize="14" FontWeight="Bold"
                                       Foreground="#A855F7" VerticalAlignment="Center"/>
                            <TextBlock Text="COMMENT SE PLACER"
                                       FontWeight="Bold" FontSize="12"
                                       Foreground="#C4B5FD"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="{Binding Settings.SetupInstructions}"
                                   FontSize="11.5"
                                   Foreground="#9B8EC4"
                                   TextWrapping="Wrap"
                                   LineHeight="18"/>
                    </StackPanel>
                </Border>

                <!-- Messages -->
                <Border Grid.Row="4" Classes="card">
                    <Grid RowDefinitions="Auto,8,*">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Text="MESSAGES"
                                       FontWeight="Bold" FontSize="13"
                                       Foreground="#8B8FA3"/>
                            <Button Grid.Column="1"
                                    Content="Vider"
                                    Command="{Binding ClearLogsCommand}"
                                    Classes="secondary"
                                    Padding="10,4"
                                    FontSize="11"/>
                        </Grid>

                        <ListBox Grid.Row="2"
                                 ItemsSource="{Binding LogEntries}"
                                 Classes="logList"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 AutoScrollToSelectedItem="True">
                        </ListBox>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- ═══ BOUTONS EN BAS ═══════════════════════════════════ -->
        <Grid Grid.Row="2" Margin="0,14,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="1"
                    Content="Lancer (F6)"
                    Command="{Binding StartMiningCommand}"
                    Classes="accent"
                    FontSize="14"
                    IsEnabled="{Binding !IsMining}"/>

            <Button Grid.Column="3"
                    Content="Arreter (F6)"
                    Command="{Binding StopMiningCommand}"
                    Classes="stop"
                    FontSize="14"
                    IsEnabled="{Binding IsMining}"/>

            <Button Grid.Column="5"
                    Content="STOP (F8)"
                    Command="{Binding EmergencyStopCommand}"
                    Classes="danger"
                    FontSize="14"/>
        </Grid>

        <!-- ═══ WATERMARK ═════════════════════════════════════════ -->
        <TextBlock Grid.Row="2"
                   Text="dialogue__ - AutoMine Obsidienne"
                   FontSize="10"
                   Foreground="#302D45"
                   HorizontalAlignment="Right"
                   VerticalAlignment="Bottom"
                   Margin="0,0,4,0"/>
    </Grid>
</Window>
